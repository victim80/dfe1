<div class="eg-content-editor" data-type="imageEditorOneColumn"><div class="column">
  <div class="cropped-image" style="position:relative;overflow: hidden;padding-top: 46.25%">
    <img style="position: absolute; top: 50%;left: 50%;transform: translate(-50%, -50%);max-width: 100%; max-height: 100%;" src="https://files-storage.easygenerator.com/image/056dc249-e426-4776-a4ef-48cf7b71af20.png" alt="" data-src="https://files-storage.easygenerator.com/image/58d53127-6889-4afd-81ee-447ecf04f4f9.png" data-init="{&quot;w&quot;:880,&quot;h&quot;:407.00000000000006,&quot;y&quot;:0,&quot;x&quot;:0,&quot;defaultScale&quot;:1.0725167580743449,&quot;scale&quot;:0.5362583790371724}">
  </div>
  <div class="row" data-content-type="TextEditor"><p style="text-align: center;">Figure 3.30: Components of EFS</p><p style="text-align: justify;"><strong>EFS Service</strong></p><p style="text-align:justify;height:normal;">The EFS service, which is a part of the security subsystem, acts as an interface with the EFS driver by using the local procedure call (LPC) communication port between the Local Security Authority (LSA) and the kernel-mode security reference monitor.</p><p style="text-align:justify;height:normal;">It also acts as an interface with CryptoAPI in the user mode in order to derive file encryption keys to generate data decryption fields (DDFs) and data recovery fields (DRFs). This service also supports Win32 application programming interfaces (APIs).</p><p style="text-align:justify;height:normal;">The EFS service uses CryptoAPI to extract the file encryption key (FEK) for a data file and uses it to encode the FEK and produce the DDF.</p><p style="text-align: justify;"><strong>EFS Driver</strong></p><p style="text-align:justify;height:normal;">The EFS driver is a file system filter driver stacked on top of NTFS. It connects with the EFS service to obtain file encryption keys, DDFs, DRFs, and other key management services.</p><p style="text-align:justify;height:normal;">It sends this information to the EFS file system runtime library (FSRTL) to perform file-system functions such as open, read, write, and append.</p><p style="text-align: justify;"><strong>CryptoAPI</strong></p><p style="text-align:justify;height:normal;">CryptoAPI contains a set of functions that allow application developers to encrypt their Win32 applications; these functions allow applications to encrypt or digitally sign data and offer security for private key data.</p><p style="text-align:justify;height:normal;">It supports public-key and symmetric-key operations such as generation, management and secure storage, exchange, encryption, decryption, hashing, digital signatures, and the verification of signature.</p><p style="text-align: justify;"><strong>EFS FSRTL</strong></p><p style="text-align:justify;height:normal;">The EFS FSRTL is a part of the EFS driver that implements NTFS callouts to handle various file-system operations such as reads, writes, and opens on encrypted files and directories, as well as operations to encrypt, decrypt, and recover file data when the system writes it to or reads it from the disk.</p><p style="text-align:justify;height:normal;">The EFS driver and FSRTL act as a single component but never communicate directly. They communicate with each other by using the NTFS file control callout mechanism.</p><p style="text-align: justify;"><strong>Win32 API</strong></p><p style="text-align: justify;">EFS provides an API set to provide access to its features; the API set also provides a programming interface for operations such as the encryption of plaintext files, decryption or recovery of ciphertext files, and import and export of encrypted files without decryption.</p></div>
</div></div>